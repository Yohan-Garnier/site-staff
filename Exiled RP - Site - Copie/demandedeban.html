<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bannissement - Exiled RP [WL]</title>
  <link rel="icon" type="image/png" href="logoex.png">
  <link rel="stylesheet" href="css/style.css" />
  <meta property="og:title" content="Exiled RP [WL] ‚Äî Serveur de Roleplay Fran√ßais" />
  <meta property="og:description" content="Rejoignez Exiled RP [WL], le serveur de roleplay fran√ßais avec une √©quipe active, des √©v√©nements et un univers immersif." />
  <meta property="og:image" content="https://exiled-rp.netlify.app/header.png" />
  <meta property="og:url" content="https://exiled-rp.netlify.app" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Exiled RP [WL]" />

  <!-- üî• Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Exiled RP [WL] ‚Äî Serveur de Roleplay Fran√ßais" />
  <meta name="twitter:description" content="Rejoignez Exiled RP [WL] ‚Äî un univers de roleplay fran√ßais immersif, avec staff et une communaut√© active." />
  <meta name="twitter:image" content="https://exiled-rp.netlify.app/header.png" />
  <!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<!-- Auth Guard -->
<script src="js/auth-guard.js"></script>

<script>
  // Initialiser la protection
  protectPage((user) => {
    console.log('Utilisateur connect√© :', user.email);
  });
</script>
</head>
<body>

  <!-- Hamburger & Sidebar -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="nav-brand">Exiled RP [WL]</div>
      <button class="close-btn" id="close-sidebar">√ó</button>
    </div>
    <nav class="sidebar-nav">
      <a href="staff.html">Accueil</a>
      <a href="serveurblacklist.html">Serveur BLACKLIST</a>
      <a href="referentielsanction.html">R√©f√©rentiel de sanction</a>
      <a href="demandedeban.html">Demande de d√©bannissement</a>
      <a href="absence.html">Faire une absence</a>
      <a href="sanction.html">Nouvelle sanction</a>
      <a href="sanctionhistorique.html">Historique de sanction</a>
      <a href="mn√©motechnique.html">Mn√©motechnique</a>
      <a href="demission.html">D√©mission</a>
      <a href="mon-compte.html"><strong>Mon compte</strong></a>
    </nav>
  </aside>

  <div class="overlay" id="overlay"></div>

    <main>
        <section class="section">
            <div class="auth-form">
                <div class="recruitment-header">
                    <img src="header.png" alt="Exiled RP [WL]" />
                </div>
                <h2>Demande de bannissement - Exiled RP [WL]</h2>
                <p class="recruitment-intro">
                    Bienvenue sur le formulaire officiel de demande de bannissement d'Exiled RP [WL].
                </p>

                <p class="required-field-note">
                    <span class="required-asterisk">*</span> Indique une question
                    obligatoire
                </p>
                
                <p><h1>Info joueur</h1></p>
                <form id="accountRequestForm">
                    <div class="form-group">
                        <label for="plateforme">Discord ou Roblox<span class="required-asterisk">*</span></label>
                        <input type="text" id="plateforme" class="auth-input" placeholder="Votre r√©ponse" required />
                    </div>

                    <div class="form-group">
                        <label for="informationjoueur">Pseudo discord et/ou roblox<span class="required-asterisk">*</span></label>
                        <input type="text" id="informationjoueur" class="auth-input" required />
                    </div>

                    <div class="form-group">
                        <label for="motif">Motif <span class="required-asterisk">*</span></label>
                        <input type="text" id="motif" class="auth-input" placeholder="Votre r√©ponse" required />
                    </div>

                    <div class="form-group">
                        <label for="preuves">Preuves (screenshots, vid√©os... <strong>le lien</strong>) <span class="required-asterisk">*</span></label>
                        <input type="text" id="preuves" class="auth-input" placeholder="Votre r√©ponse" required /> 
                    </div>

                    <button type="submit" class="btn primary">Envoyer</button>
                </form>

                <div id="status"></div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Exiled RP [WL] ‚Äî Tous droits r√©serv√©s.</p>
    </footer>

  <!-- üî• Firebase Auth uniquement -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBcB45diMSO7rWWzp25EdqLHrhgENM7jj0",
      authDomain: "marseille-rp-73905.firebaseapp.com",
      projectId: "marseille-rp-73905",
      storageBucket: "marseille-rp-73905.firebasestorage.app",
      messagingSenderId: "633653493501",
      appId: "1:633653493501:web:94210bcc5a99d6fd114894"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged((user) => {
      if (user) {
        document.getElementById('user-display').textContent = user.email;
      } else {
        window.location.href = 'login.html';
      }
    });

    window.signOut = () => {
      auth.signOut().then(() => window.location.href = 'login.html');
    };
  </script>

  <!-- Sidebar JS -->
  <script>
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const closeBtn = document.getElementById('close-sidebar');

    if (hamburger) hamburger.addEventListener('click', () => {
      sidebar.classList.add('active');
      overlay.classList.add('active');
      hamburger.style.display = 'none';
    });

    if (closeBtn) closeBtn.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      hamburger.style.display = 'flex';
    });

    if (overlay) overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      hamburger.style.display = 'flex';
    });
  </script>

    <script>
        // Formulaire Discord Webhook
        document.getElementById('accountRequestForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // R√©cup√©rer les √©l√©ments
            const plateformeElement = document.getElementById('plateforme');
            const informationjoueurElement = document.getElementById('informationjoueur');
            const motifElement = document.getElementById('motif');
            const preuvesElement = document.getElementById('preuves');

            if (!plateformeElement || !informationjoueurElement || !motifElement || !preuvesElement) {
                console.error("Un ou plusieurs champs sont manquants dans le formulaire.");
                return;
            }

            const plateforme = plateformeElement.value;
            const informationjoueur = informationjoueurElement.value;
            const motif = motifElement.value;
            const preuves = preuvesElement.value;

            // R√©cup√©rer les infos du compte connect√©
            const user = firebase.auth().currentUser;
            if (!user) {
                document.getElementById('status').innerHTML = '<p style="color: #dc3545;">‚ùå Vous devez √™tre connect√© pour envoyer ce formulaire.</p>';
                return;
            }

            // R√©cup√©rer les infos Firestore
            db.collection('users').doc(user.uid).get().then(doc => {
              if (doc.exists) {
                const userData = doc.data();
                const userEmail = user.email;
                const userUID = user.uid;
                const username = userData.username || 'Aucun';
                const discordId = userData.discordId || 'Aucun';
                const pseudoRoblox = userData.pseudoRoblox || 'Aucun';
                const grade = userData.grade || 'Aucun';
                const createdAt = userData.createdAt ? userData.createdAt.toDate().toLocaleDateString() : 'Aucune';

                // üî• REMPLACEZ CES VALEURS AVEC LES VOTRES !
                const webhookURL = 'https://discord.com/api/webhooks/1435342452193103964/KmAc3YpvakkJ5QIOLxBUGOUFUiGwZ1u1WSB6pw_WUgM87qjn-UYuOkPzDFpWJgkzQJlX';
                const roleID = '1435150278545506419';
                const logsWebhookURL = 'https://discord.com/api/webhooks/1440759750739365998/brQgi-0X8VY7b6bP1AZpCCwc9luyL0M9jeShf8YufTWsibvqyXW9vV01DngaOOpueUms';

                // Webhook principal (mentionne le r√¥le)
                const payload = {
                    content: `<@&${roleID}> Nouvelle demande de banissement !`,
                    embeds: [{
                        title: "üì• Nouvelle demande de bannissement re√ßu",
                        fields: [
                            { name: "üë§ Pseudo Discord du STAFF", value: username, inline: true },
                            { name: "ü§ñ Pseudo Roblox du STAFF", value: pseudoRoblox, inline: true },
                            { name: "üéñÔ∏è Grade du STAFF", value: grade, inline: false },
                            { name: "üìß Email du STAFF", value: userEmail, inline: false },
                            { name: "ü§ñ ID Discord du STAFF", value: discordId, inline: false },
                            { name: "üìÖ Date de cr√©ation du compte", value: createdAt, inline: false },
                            { name: "üåê Plateforme (Discord ou Roblox)", value: plateforme, inline: false },
                            { name: "üë• Informations du JOUEUR", value: informationjoueur, inline: false },
                            { name: "‚ö†Ô∏è Motif", value: motif, inline: false },
                            { name: "üì∏ Preuves", value: preuves, inline: false }
                        ],
                        color: 3381759,
                        footer: { text: `Exiled RP [WL] ‚Ä¢ R√©ponse automatique ‚Ä¢ UID: ${userUID}` }
                    }]
                };

                // Webhook de logs
                const logPayload = {
                  embeds: [{
                    title: "üìù Nouvelle r√©ponse de formulaire",
                    fields: [
                      { name: "üë§ Pseudo Discord du STAFF", value: username, inline: true },
                      { name: "ü§ñ Pseudo Roblox du STAFF", value: pseudoRoblox, inline: true },
                      { name: "üìß Email du STAFF", value: userEmail, inline: true },
                      { name: "üÜî UID", value: userUID, inline: false },
                      { name: "üìÑ Formulaire", value: "Demande de bannissement", inline: false }
                    ],
                    color: 3381759,
                    footer: { text: "Exiled RP [WL] ‚Ä¢ Logs automatiques" }
                  }]
                };

                // Envoyer les deux webhooks
                Promise.all([
                  fetch(webhookURL, {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(payload)
                  }),
                  fetch(logsWebhookURL, {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(logPayload)
                  })
                ])
                .then(([response1, response2]) => {
                  if (response1.ok && response2.ok) {
                    document.getElementById('status').innerHTML = '<p style="color: #28a745;">‚úÖ Votre r√©ponse nous a √©t√© transmise.</p>';
                    this.reset();
                  } else {
                    throw new Error('Erreur r√©seau ou webhook incorrect.');
                  }
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('status').innerHTML = '<p style="color: #dc3545;">‚ùå Erreur lors de l‚Äôenvoi. V√©rifiez votre connexion.</p>';
                });
              } else {
                document.getElementById('status').innerHTML = '<p style="color: #dc3545;">‚ùå Donn√©es utilisateur manquantes.</p>';
              }
            });
        });
    </script>
</body>
</html>